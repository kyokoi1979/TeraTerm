# TeraTerm用マクロ
下記のことが出来ます。

* リストを読み込み、1台あるいはリスト内全てのサーバへのログイン
* 踏み台を利用した多段ログイン(2段まで)
* コマンドリストによる、ログイン後処理の自動化(あくまでコマンドを順番に実行するだけです)
* ログの自動取得
  * 年月日、ホストリストの登録名、ダイアログで入力したコメントに応じたファイル名を生成
  * 年月日ごとにディレクトリ自動生成して仕分ける機能

## Version
TeraTerm Macro v 1.0.6

## 既知の問題
- TeraTerm 5.0 ~ 5.3でマクロを日本語を含めたパスに配置すると、パスワード設定がうまくいかない(読み込みだけならOK)
  - [こちら](https://github.com/TeraTermProject/teraterm/issues/422)で報告済み 

## 更新履歴
1.0.6( 2025/1/12 )
- TeraTerm 5.0～5.2のバージョンで日本語を含むパスにマクロを配置した場合に不具合があるため、バージョンチェックを追加
  (getpasswordの不具合)
  https://github.com/TeraTermProject/teraterm/issues/161
- TeraTerm 5.3でTTLファイルの文字コードがUTF-8(BOM無し)の場合に不具合があるためUTF-8(BOM付き)に変更
  - そのうち戻します
- logディレクトリが存在しない場合にエラーとなる不具合を修正
- パスワードファイル生成マクロをCSVからの読み込みに変更

1.0.5( 2024/6/23 )
- TERATERM.INIを5.2で作成
- ホストリストの書式変更
- パスワードリストに接続先情報を含めて保存するように書式変更
- TeraTermの内部コード変更に伴いリストファイルやマクロをUTF-8に変更

1.0.4( 2021/6/6 )
- ログイン先ホストをチェックするようにした(hostname -sコマンドとリストのホスト名を比較する)
- 接続エラー時の処理を変更
- 不具合修正

1.0.3( 2021/6/6 )
- パスワード情報の暗号化

1.0.2( 2021/6/6 )
1.0.1( 2021/6/5 )
1.0.0( 2021/6/3 )
- 以前作っていたマクロを現バージョンで動くようにした

## 動作確認
下記バージョンで動作確認しています。
その他でも動くと思いますがテストしていません。

5.3(2024/9/8)

## 動作に必要なもの
### ホストリスト(conf/host.list)
- ログイン情報を記入します
- リストはタブ区切り、文字コードはUTF-8(BOM無し)、改行CR+LFで保存する必要があります
- ファイルが存在しない場合、ダイアログから指定できます
- 行の先頭が#の場合はコメントとして扱います

書式については、 `ホストリスト.xlsm` を参照してください。
なお、TeraTermマクロの仕様上、ホストリストをエディタ等で開いた状態では動作しません。

|表示名|ホスト名|ログインIP①|OS種別①|ログインユーザ①|ログインIP②|OS種別②|ログインユーザ②|
|--|--|--|--|--|--|--|--|
|テストサーバ#1|testsv01|192.168.0.1|Linux|linux||||
|テストサーバ#2|testsv02|192.168.0.2|Linux2|linux|172.16.0.1|Linux|linux|

|項目|用途|
|--|--|
|表示名|リスト選択時に表示される名称|
|ホスト名|hostname -sで表示されるホスト名(ログイン確認に用います)多段ログインの場合は2台目のホスト名|
|ログインIP①|ログイン先のIPアドレス、ホスト名|
|OS種別①|ログイン先のOS種別Linux, ESX|
|ログインユーザ①|ログインユーザ|
|ログインIP②|2台目のログインIPアドレス、ホスト名|
|OS種別②|2台目のOS種別Linux, ESX|
|ログインユーザ②|2台目のログインユーザ|

※OS種別については「Linux」「ESX」を含めば問題ありません。
　ESXはチャレンジレスポンス認証がデフォルトなので認証方式の変更に用いています。 
　また、ログイン時に自動実行されるコマンドやプロンプトの判別が異なります。

#### ホストリスト.xlsm
- **マクロ付きのファイルになっていますが、TeraTerm側の仕様変更に対応出来ていないので対象範囲をコピーしてリストファイルに上書きしてください**
- **UTF-8で保存できるように書き換えれば使用可能です**


### パスワードファイル(conf/password.dat) 
- 暗号化されたパスワードが保存されていますが簡単に復元可能です
- ファイルの取り扱いには注意してください
- 将来的にもっと安全な実装がされそうな気配もあるので待ちます
  - [add：ttpmacro setpassword、getpassword暗号化機能追加 #213](https://github.com/TeraTermProject/teraterm/issues/213)
  → 機能は追加されたものの、パスワードファイルのみ盗まれるという状況は考えづらいので保留
- 事前に生成できますが、対象のログイン情報が存在しなければ入力を促されます
- 事前に生成する場合は`パスワードファイル生成.ttl`を実行します

```
[Password]
[接続先]___[ユーザ名]=[暗号化されたパスワード]
192.168.0.1___root=Slhgq?IC`W-*B:mp3J==gll}
```

### パスワードファイル生成(パスワードファイル生成.ttl)
ログイン先、ユーザ名、パスワードをCSV形式で保存して読み込ませてください。
passwordlist.csvが存在すれば読み込みます。(無ければダイアログから選択)

|ホスト名orIPアドレス|ユーザ名|パスワード|
|--|--|--|
|192.168.0.1|test|test|

### TeraTerm設定ファイル(conf/TERATERM.INI)

TeraTermが起動するときの設定ファイルです。

- 環境による差異をなくすため、マクロと同じディレクトリの設定ファイルを読み込むようにしています
- 好みに応じてカスタマイズしてください
- ただし、ログ取得はマクロで行うので自動取得は入れないようにしてください

### コマンドリスト(cmdlist/command_[OS種別].list)

- OS種別ごとにコマンドを自動実行させるために利用します
- リストファイルが無ければダイアログから選択するようになっています
- 中身が空で良いので必ず用意してください
- ユーザ入力を促すようなコマンドへの応答は出来ません

たとえば、ホストリストで「Linux_hoge」としている場合は`conf/command_Linux_hoge.list`を準備してください。
